<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Results Test Page - RubriCheck</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for testing */
        .highlight-yellow { background-color: #fef3c7; }
        .highlight-blue { background-color: #dbeafe; }
        .highlight-green { background-color: #d1fae5; }
        .highlight-pink { background-color: #fce7f3; }
        .highlight-purple { background-color: #e9d5ff; }
        
        .confidence-low { border-left: 4px solid #ef4444; }
        .confidence-medium { border-left: 4px solid #f59e0b; }
        .confidence-high { border-left: 4px solid #10b981; }
        
        .keyboard-focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        .evidence-highlight {
            background-color: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 4px;
            padding: 2px 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .evidence-highlight:hover {
            background-color: #fde68a;
            transform: scale(1.02);
        }
        
        .evidence-highlight.active {
            background-color: #f59e0b;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <h1 class="text-xl font-semibold text-gray-900">RubriCheck Results — Student View</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="export-pdf" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            Export PDF
                        </button>
                        <button id="export-csv" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500">
                            Export CSV
                        </button>
                        <button id="accessibility-toggle" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500">
                            Accessibility
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Overall Score Summary -->
            <div class="bg-white rounded-lg shadow-sm border p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-900">Overall Score</h2>
                    <div class="text-right">
                        <div class="text-4xl font-bold text-blue-600" id="overall-score">78.5</div>
                        <div class="text-lg text-gray-600" id="letter-grade">B+</div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                    <div>
                        <span class="font-medium text-gray-700">Word Count:</span>
                        <span id="word-count">324</span>
                    </div>
                    <div>
                        <span class="font-medium text-gray-700">Reading Time:</span>
                        <span id="reading-time">2-3 minutes</span>
                    </div>
                    <div>
                        <span class="font-medium text-gray-700">Submitted:</span>
                        <span id="timestamp">Jan 15, 2024 at 2:30 PM</span>
                    </div>
                </div>
            </div>

            <!-- Split View Container -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Left Panel: Essay Viewer -->
                <div class="bg-white rounded-lg shadow-sm border">
                    <div class="p-4 border-b bg-gray-50">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">Your Essay (Annotated)</h3>
                            <div class="flex items-center space-x-2">
                                <button id="toggle-annotated" class="px-3 py-1 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    Annotated
                                </button>
                                <button id="toggle-original" class="px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500">
                                    Original
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div id="essay-content" class="prose max-w-none">
                            <!-- Essay content will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Rubric & Feedback -->
                <div class="bg-white rounded-lg shadow-sm border">
                    <div class="p-4 border-b bg-gray-50">
                        <h3 class="text-lg font-semibold text-gray-900">Rubric & Feedback</h3>
                        <div class="mt-2">
                            <input type="text" id="search-criteria" placeholder="Search criteria..." 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="p-4">
                        <div id="criteria-list" class="space-y-4">
                            <!-- Criteria cards will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Help Section -->
            <div class="mt-8 bg-blue-50 rounded-lg p-6">
                <h3 class="text-lg font-semibold text-blue-900 mb-4">How to read your results</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-blue-800">
                    <div>
                        <h4 class="font-semibold mb-2">Left panel: "Your Essay (Annotated)"</h4>
                        <ul class="space-y-1">
                            <li>• Yellow highlights show text the AI used as evidence</li>
                            <li>• Hover or tap a criterion to spotlight matching highlights</li>
                            <li>• Use the Annotated / Original toggle to switch views</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">Right panel: "Rubric & Feedback"</h4>
                        <ul class="space-y-1">
                            <li>• Level badge shows your current performance</li>
                            <li>• Score bar shows 1–5 scale for quick scanning</li>
                            <li>• "Why?" explains the score with specific evidence</li>
                            <li>• "Try this next" gives actionable improvement tips</li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Test data (simplified version of the TypeScript data)
        const testData = {
            id: "test_student_result_001",
            essay_text: `The Impact of Social Media on Teen Mental Health

Social media has become an integral part of teenage life, but its effects on mental health are increasingly concerning. While platforms like Instagram and TikTok offer opportunities for connection and self-expression, they also create unrealistic expectations and contribute to anxiety and depression among young people.

Research consistently shows that excessive social media use correlates with higher rates of anxiety and depression in teenagers. A 2023 study by the American Psychological Association found that teens who spend more than three hours daily on social media are twice as likely to experience symptoms of depression compared to their peers who use it less frequently. This correlation suggests that social media platforms may be contributing to mental health challenges rather than alleviating them.

The comparison culture fostered by social media is particularly harmful to teen mental health. When teenagers constantly see curated, filtered images of their peers' lives, they often feel inadequate about their own experiences. This phenomenon, known as "social comparison," leads to decreased self-esteem and increased feelings of loneliness. For example, seeing friends' vacation photos or academic achievements can make teens feel like they're falling behind in life.

However, social media also provides valuable support networks for teenagers facing mental health challenges. Online communities offer safe spaces where teens can share their experiences and find peer support. Many teenagers report that social media has helped them connect with others who understand their struggles, particularly for those dealing with conditions like anxiety or depression.

The key to addressing social media's impact on teen mental health lies in promoting digital literacy and healthy usage habits. Parents and educators should work together to teach teenagers how to use social media mindfully, including recognizing when content is unrealistic or harmful. Schools can implement programs that help students develop critical thinking skills about online content and encourage face-to-face social interactions.

In conclusion, while social media presents both opportunities and challenges for teen mental health, the evidence suggests that its negative effects often outweigh the benefits. By promoting digital literacy and healthy usage patterns, we can help teenagers navigate social media in ways that support rather than undermine their mental wellbeing.`,
            overall_score: 78.5,
            letter_grade: "B+",
            timestamp: "2024-01-15T14:30:00Z",
            metadata: {
                word_count: 324,
                paragraph_count: 6,
                reading_time: "2-3 minutes"
            },
            criteria: [
                {
                    id: "thesis",
                    name: "Thesis & Argument",
                    weight: 25,
                    score: 4.2,
                    level: "Proficient",
                    confidence: 0.89,
                    evidence_spans: [
                        {
                            start: 45,
                            end: 120,
                            paragraph: 1,
                            text: "Social media has become an integral part of teenage life, but its effects on mental health are increasingly concerning. While platforms like Instagram and TikTok offer opportunities for connection and self-expression, they also create unrealistic expectations and contribute to anxiety and depression among young people.",
                            relevance_score: 0.95
                        }
                    ],
                    feedback: {
                        why: "Your thesis clearly states the main argument about social media's dual impact on teen mental health. It's specific and appears early in the introduction.",
                        suggestion: "Consider making your thesis even more specific by mentioning the key factors you'll analyze (comparison culture, support networks, digital literacy).",
                        strengths: ["Clear position statement", "Early placement in essay", "Addresses complexity of the issue"],
                        areas_for_improvement: ["Could be more specific about key points to be covered"]
                    }
                },
                {
                    id: "evidence",
                    name: "Evidence & Analysis",
                    weight: 30,
                    score: 3.8,
                    level: "Meets expectations",
                    confidence: 0.92,
                    evidence_spans: [
                        {
                            start: 180,
                            end: 280,
                            paragraph: 2,
                            text: "Research consistently shows that excessive social media use correlates with higher rates of anxiety and depression in teenagers. A 2023 study by the American Psychological Association found that teens who spend more than three hours daily on social media are twice as likely to experience symptoms of depression compared to their peers who use it less frequently.",
                            relevance_score: 0.88
                        }
                    ],
                    feedback: {
                        why: "You provide solid research evidence and explain how it supports your argument. The APA study adds credibility to your claims.",
                        suggestion: "Add more analysis after presenting evidence. Explain WHY the correlation exists and what it means for teenagers specifically.",
                        strengths: ["Strong research citation", "Relevant statistics", "Clear connection to argument"],
                        areas_for_improvement: ["Need deeper analysis of evidence", "Could use more diverse sources"]
                    }
                },
                {
                    id: "organization",
                    name: "Organization & Structure",
                    weight: 20,
                    score: 4.0,
                    level: "Proficient",
                    confidence: 0.85,
                    evidence_spans: [],
                    feedback: {
                        why: "Your essay follows a logical structure with clear topic sentences and smooth transitions between paragraphs.",
                        suggestion: "Consider adding transitional phrases between paragraphs to make the flow even smoother.",
                        strengths: ["Logical progression", "Clear topic sentences", "Good paragraph structure"],
                        areas_for_improvement: ["Could use stronger transitions", "Some paragraphs could be more connected"]
                    }
                },
                {
                    id: "style",
                    name: "Style & Mechanics",
                    weight: 15,
                    score: 3.5,
                    level: "Meets expectations",
                    confidence: 0.78,
                    evidence_spans: [],
                    feedback: {
                        why: "Your writing is generally clear and grammatically correct, with varied sentence structures.",
                        suggestion: "Watch for run-on sentences and consider breaking some longer sentences into shorter, more impactful ones.",
                        strengths: ["Clear communication", "Good vocabulary", "Mostly correct grammar"],
                        areas_for_improvement: ["Some sentence length issues", "Minor punctuation errors"]
                    }
                },
                {
                    id: "conclusion",
                    name: "Conclusion",
                    weight: 10,
                    score: 4.5,
                    level: "Excellent",
                    confidence: 0.94,
                    evidence_spans: [
                        {
                            start: 580,
                            end: 650,
                            paragraph: 6,
                            text: "In conclusion, while social media presents both opportunities and challenges for teen mental health, the evidence suggests that its negative effects often outweigh the benefits. By promoting digital literacy and healthy usage patterns, we can help teenagers navigate social media in ways that support rather than undermine their mental wellbeing.",
                            relevance_score: 0.96
                        }
                    ],
                    feedback: {
                        why: "Your conclusion effectively summarizes the main points and provides a clear call to action. It ties back to your thesis perfectly.",
                        suggestion: "This is excellent! You might consider adding a brief mention of specific steps parents and educators can take.",
                        strengths: ["Strong summary", "Clear call to action", "Ties back to thesis", "Forward-looking"],
                        areas_for_improvement: ["Could be slightly more specific about next steps"]
                    }
                }
            ]
        };

        // Track expanded criteria
        let expandedCriteria = new Set();

        // Initialize the test page
        function initializeTestPage() {
            populateOverallScore();
            populateEssayContent();
            populateCriteriaList();
            setupEventListeners();
            setupKeyboardNavigation();
        }

        function populateOverallScore() {
            document.getElementById('overall-score').textContent = testData.overall_score;
            document.getElementById('letter-grade').textContent = testData.letter_grade;
            document.getElementById('word-count').textContent = testData.metadata.word_count;
            document.getElementById('reading-time').textContent = testData.metadata.reading_time;
            document.getElementById('timestamp').textContent = new Date(testData.timestamp).toLocaleString();
        }

        function populateEssayContent() {
            const essayContent = document.getElementById('essay-content');
            let essayHTML = testData.essay_text.replace(/\n\n/g, '</p><p>');
            essayHTML = '<p>' + essayHTML + '</p>';
            
            // Check if we're in annotated mode (default is annotated)
            const isAnnotated = document.getElementById('toggle-annotated').classList.contains('bg-blue-600');
            
            if (isAnnotated) {
                // Add evidence highlights only in annotated mode
                testData.criteria.forEach((criterion, criterionIndex) => {
                    criterion.evidence_spans.forEach((span, spanIndex) => {
                        const highlightId = `highlight-${criterionIndex}-${spanIndex}`;
                        const highlightedText = `<span class="evidence-highlight" id="${highlightId}" data-criterion="${criterion.id}" data-criterion-name="${criterion.name}" onclick="highlightEvidence('${criterion.id}')">${span.text}</span>`;
                        essayHTML = essayHTML.replace(span.text, highlightedText);
                    });
                });
            }
            // In original mode, essayHTML remains clean without any highlights
            
            essayContent.innerHTML = essayHTML;
        }

        function toggleCriterionExpansion(criterionId) {
            if (expandedCriteria.has(criterionId)) {
                expandedCriteria.delete(criterionId);
            } else {
                expandedCriteria.add(criterionId);
            }
            populateCriteriaList();
        }

        function populateCriteriaList() {
            const criteriaList = document.getElementById('criteria-list');
            criteriaList.innerHTML = '';

            testData.criteria.forEach((criterion, index) => {
                const confidenceClass = criterion.confidence > 0.8 ? 'confidence-high' : 
                                      criterion.confidence > 0.6 ? 'confidence-medium' : 'confidence-low';
                
                const levelColors = {
                    'Excellent': 'bg-emerald-100 text-emerald-800',
                    'Proficient': 'bg-sky-100 text-sky-800',
                    'Meets expectations': 'bg-amber-100 text-amber-800',
                    'Developing': 'bg-rose-100 text-rose-800',
                    'Poor': 'bg-red-100 text-red-800'
                };

                const isExpanded = expandedCriteria.has(criterion.id);

                const criterionCard = document.createElement('div');
                criterionCard.className = `border rounded-lg ${confidenceClass} focus:outline-none focus:ring-2 focus:ring-blue-500`;
                criterionCard.tabIndex = 0;
                criterionCard.dataset.criterionId = criterion.id;
                criterionCard.dataset.criterionIndex = index;

                criterionCard.innerHTML = `
                    <!-- Top Status - Always Visible -->
                    <div class="p-4 cursor-pointer hover:bg-gray-50 transition-colors" onclick="toggleCriterionExpansion('${criterion.id}')">
                        <div class="flex items-center justify-between">
                            <h4 class="font-semibold text-gray-900">${criterion.name}</h4>
                            <div class="flex items-center space-x-2">
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${levelColors[criterion.level]}">
                                    ${criterion.level}
                                </span>
                                <span class="text-sm text-gray-500">${criterion.score.toFixed(1)}/5.0</span>
                                <button class="p-1 text-gray-400 hover:text-gray-600 focus:outline-none" onclick="event.stopPropagation(); toggleCriterionExpansion('${criterion.id}')">
                                    ${isExpanded ? 
                                        '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>' :
                                        '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>'
                                    }
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-2">
                            <div class="flex items-center justify-between text-sm mb-1">
                                <span>Score</span>
                                <span class="text-xs ${criterion.confidence > 0.8 ? 'text-green-600' : criterion.confidence > 0.6 ? 'text-yellow-600' : 'text-red-600'}">
                                    ${criterion.confidence > 0.8 ? 'High' : criterion.confidence > 0.6 ? 'Medium' : 'Low'} Confidence
                                </span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: ${(criterion.score / 5) * 100}%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Expandable Content - Hidden by Default -->
                    ${isExpanded ? `
                        <div class="px-4 pb-4 border-t bg-gray-50">
                            <div class="pt-4 space-y-3">
                                <div>
                                    <h5 class="font-medium text-gray-700 mb-1">Why this level?</h5>
                                    <p class="text-sm text-gray-600">${criterion.feedback.why}</p>
                                </div>
                                
                                <div>
                                    <h5 class="font-medium text-gray-700 mb-1">Try this next:</h5>
                                    <p class="text-sm text-gray-600">${criterion.feedback.suggestion}</p>
                                </div>

                                ${criterion.evidence_spans.length > 0 ? `
                                    <button class="show-evidence-btn text-sm text-blue-600 hover:text-blue-800 focus:outline-none focus:underline" 
                                            data-criterion-id="${criterion.id}">
                                        Show evidence (${criterion.evidence_spans.length} span${criterion.evidence_spans.length > 1 ? 's' : ''})
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}
                `;

                criteriaList.appendChild(criterionCard);
            });
        }

        function setupEventListeners() {
            // Toggle between annotated and original views
            document.getElementById('toggle-annotated').addEventListener('click', () => {
                document.getElementById('essay-content').classList.remove('original-view');
                document.getElementById('toggle-annotated').classList.add('bg-blue-600', 'text-white');
                document.getElementById('toggle-annotated').classList.remove('bg-gray-300', 'text-gray-700');
                document.getElementById('toggle-original').classList.add('bg-gray-300', 'text-gray-700');
                document.getElementById('toggle-original').classList.remove('bg-blue-600', 'text-white');
                // Re-render essay with highlights
                populateEssayContent();
            });

            document.getElementById('toggle-original').addEventListener('click', () => {
                document.getElementById('essay-content').classList.add('original-view');
                document.getElementById('toggle-original').classList.add('bg-blue-600', 'text-white');
                document.getElementById('toggle-original').classList.remove('bg-gray-300', 'text-gray-700');
                document.getElementById('toggle-annotated').classList.add('bg-gray-300', 'text-gray-700');
                document.getElementById('toggle-annotated').classList.remove('bg-blue-600', 'text-white');
                // Re-render essay without highlights
                populateEssayContent();
            });

            // Show evidence functionality
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('show-evidence-btn')) {
                    const criterionId = e.target.dataset.criterionId;
                    highlightEvidence(criterionId);
                }
            });

            // Export functionality
            document.getElementById('export-pdf').addEventListener('click', () => {
                alert('PDF export functionality would be implemented here');
            });

            document.getElementById('export-csv').addEventListener('click', () => {
                alert('CSV export functionality would be implemented here');
            });

            // Accessibility toggle
            document.getElementById('accessibility-toggle').addEventListener('click', () => {
                document.body.classList.toggle('high-contrast');
                alert('Accessibility features toggled');
            });

            // Search functionality
            document.getElementById('search-criteria').addEventListener('input', (e) => {
                filterCriteria(e.target.value);
            });
        }

        function setupKeyboardNavigation() {
            let currentCriterionIndex = 0;
            const criterionCards = document.querySelectorAll('[data-criterion-index]');

            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    currentCriterionIndex = Math.min(currentCriterionIndex + 1, criterionCards.length - 1);
                    focusCriterion(currentCriterionIndex);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    currentCriterionIndex = Math.max(currentCriterionIndex - 1, 0);
                    focusCriterion(currentCriterionIndex);
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    const currentCard = criterionCards[currentCriterionIndex];
                    const showEvidenceBtn = currentCard.querySelector('.show-evidence-btn');
                    if (showEvidenceBtn) {
                        showEvidenceBtn.click();
                    }
                }
            });
        }

        function focusCriterion(index) {
            const criterionCards = document.querySelectorAll('[data-criterion-index]');
            criterionCards.forEach(card => card.classList.remove('keyboard-focus'));
            if (criterionCards[index]) {
                criterionCards[index].classList.add('keyboard-focus');
                criterionCards[index].focus();
                criterionCards[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function highlightEvidence(criterionId) {
            // Auto-expand the criterion when evidence is clicked
            if (!expandedCriteria.has(criterionId)) {
                expandedCriteria.add(criterionId);
                populateCriteriaList();
            }

            // Remove existing active highlights
            document.querySelectorAll('.evidence-highlight.active').forEach(highlight => {
                highlight.classList.remove('active');
            });

            // Highlight evidence for the selected criterion
            document.querySelectorAll(`[data-criterion="${criterionId}"]`).forEach(highlight => {
                highlight.classList.add('active');
                highlight.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });
        }

        function filterCriteria(searchTerm) {
            const criterionCards = document.querySelectorAll('[data-criterion-index]');
            criterionCards.forEach(card => {
                const criterionName = card.querySelector('h4').textContent.toLowerCase();
                const matches = criterionName.includes(searchTerm.toLowerCase());
                card.style.display = matches ? 'block' : 'none';
            });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeTestPage);

        // Add CSS for original view
        const style = document.createElement('style');
        style.textContent = `
        .original-view .evidence-highlight {
            background-color: transparent !important;
            border: none !important;
            cursor: default !important;
            padding: 0 !important;
        }
            .high-contrast {
                filter: contrast(150%) brightness(110%);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
